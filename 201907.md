

## 20190701

### 요약

전에 아쉬운 점이라고 적었던 대로 url을 하드코딩 보단 변수를 통해 전달하는 방식을 이용해보았다.

이를 통해 url namespace를 나누었고 viewfunction의 이름 또한 깔끔히 다시 정리함.

reply delete 기능을 구현했다

password 인증을 추가했다.



### 내용

#### How to set url namespace

urls.py 에서

 `path("replytest/", include(('reply.urls','reply'), namespace="reply"))`  이와 같은 식으로 namespace를 정해준다.

[출처 stackoverflow](https://stackoverflow.com/questions/51818007/django-social-django-specifying-a-namespace-in-include-without-providing-an-a)



#### url with parameters

만약 variable을 이용하는 url일 경우 그 variable이 적용된 url을 설정하고싶다면

ex) in `urls.py` of an app

```
urlpatterns=[
	...
	path('create/<int:articleId>', views.replyCreate, name="replyCreate"),
	...
]
```

in some htmlfile of another app

```
{% url 'reply:replyCreate' 14 %}
```

이런 식으로 전달하면 articleId가 14인 reply:replyCreate이라는 이름의 url을 보여준다.

또한 만약 view function에서 template에게 article id를 넘겨준다면 그것을 이용할 수도 있다.

ex ) `{% url 'reply:replyCreate' article.id %}` 어떤 변수를 view function에서 넘겨주는 지는 상황마다 다름. 예시일 뿐.

또한 template 의 변수를 어느 영역에서 까지 쓸 수 있나 싶었는데

```
replyid=self.parentElement.getAttribute("replyid")
$.post({
url: "{% url 'reply:delete' article.id %}",
 ...
```

이렇게 js 안에서도 쓸 수 있는 것을 보아 어디서든 문자열 자체로 바뀌어 쓸 수 있는 것 같다.

js variable을 url의 argument로 전달해야하는 경우. 예를 들어 var replyId=15 인데

'delete/\<int:id\>' 이런 식의 url을 이용하고 싶은 경우

`delete/<int:id>` 의 url 이외에 `delete/`라는 url을 따로 또 등록해주어서 거기에 js 변수를 append 하는 식으로 이용할 수도 있다.

ex) `url= "{% url 'reply:delete_raw' %}"+replyid`  

혹은

[stackoverflow 참조](https://stackoverflow.com/questions/17832194/get-javascript-variables-value-in-django-url-template-tag)

`url= "{% url 'reply:delete' 9999 %}".replace("9999", replyid),` 이런 식의 트릭을 이용할 수도 있다.



#### 보완활 점

이제 어느 정도 게시판을 가진 홈페이지의 기능정도는 구현했는데, 학교 형이랑 얘기해본 결과 Django 자체의 깊은 수준보다는 AWS services랑 잘 연결 시켜보라는 조언을 듣고 sqlite3 에서 aws DB로 바꾸어 이용해보는 방향을 생각 중.

댓글도 article도 모두 password 가 일치해야 삭제, 수정되게 바꿔야한다. 약간 반복된 노가다..



## 20190702~0704

### 요약

새로운 내용을 배웠다기 보다는 0701에 적었던 대로 article과 comment의 password가 일치할 때에만  수정. 삭제할 수 있도록 구현하는 중이다.



### 내용

특이한 내용 없이 그냥 post로 password와 article 및 content의 내용을 보내고,

pw가 일치할 경우 Delete or Update 하는 식.



### 아쉬운 점 및 보완할 점

update, delete form 은 좀 허접하지만, 기본 HTML로 디자인했다. frontend를 깊이 공부하는 목적이 아니므로.

View count를 적용하고 싶다. -> 그럼 DB model에서 CharField 말고 IntegerField 이런 것도 있나? 있겠지?

미니멀한 디자인으로라도 admin 페이지를 구성해보고싶긴함.

사진이나 동영상, 첨부파일 업로드도 다루어보고싶다. nodejs에서 다루었던 youtube playlist 다운로드를 할 수 있게 하면 재밌을듯.

[class view video](https://www.youtube.com/watch?v=-s7e_Fy6NRU&list=PL-osiE80TeTtoQCKZ03TU5fNfx2UY6U4p&index=10) 에 나온 개념을 이용해서 Article view를 이용해보고싶음.



## 20190705

### 요약

Django의 Class Based View를 이용해보았다.

Article List를 나타낼 때는 ListView를 상속받아 as_view()를 이용해 구현했고, create page는 따로 분리시켰다.

자기 자신을 primary key 로 갖는 model들을 얻을 수 있다.



### 내용

#### class view 써보니까 어떤가

class어제 적었던 대로 class based view를 이용해보았는데, 왜 Django가 기본적으로 제공하는 걸로 빠르고 편리하게 만들 수는 있지만, 자기 입맛에 맞춰 구성하기는 적절하지 않을 수 있다는 지 알 것 같다.

ListView를 이용하든 Detail View를 이용하든, 그것의 기본 용도에 맞춰 쓰기는 편리한데, 섞어서 쓰기는 좀... 그러니까 섞어서 쓰기에는 굳이 이용할 필요가 없음. 그냥 안 쓰는 거랑 비슷. 몇 줄 줄이자고, 새로운 개념을 도입하는 느낌이랄까.

ListView를 이용하는 경우는 DataBase의 **Data를 알아서 pagination 을 해준다는 장점**은 있는 것 같다.



#### 자신을 primary key로 갖는 query set 얻기

예를 들어 Article model이 있고 그 Article model을 primary key로 갖는 Comment model들이 있다고 가정하자.

첫 번째 Article의 Comment 개수를 얻고싶다면

in python

```
article=Article.objects.all()[0]
# print(dir(article)) # 로 목록은 확인 가능.
comments=article.comment_set.all()
print(comment.count())
```

이런 식으로 이용할 수 있고, django template 내에서는 한 Article 객체 변수를 article 이라고 한다면 `article.comment_set.count` 로 Comment 개수를 얻을 수 있다.

![0705_subset.png](imgs/0705_subset.png)

### 아쉬운 점, 보완할 점

생각보다 Class Based View가 별로 편리한 지 모르겠어서 조금 아쉽다.

음... blog 자체의 컨셉과는 딱히 필요없을 것 같긴한데, 파일이나 image 업로드 같은 부분이랑 Authentication 부분은 다뤄보긴해야할 것 같고, 이것만 다루면 Django에서 더 할만 한 내용은 딱히 없지 않나 싶다.



## 20190706~0709

### 요약

요즘은 Django 보다는 동아리에서 진행하는 해킹/보안 스터디를 하느라 조금 바빴던 것 같다. 그래도 방학이라고 조금씩 놀러다니기도 했고 ㅎㅎ

주로 웹해킹에 관심이 많았는데 ,XSS나 SQL injection 위주로 배웠고, webhacking.kr 을 이용해 문제를 조금 풀어보기도 했다. 원래 방학 때 DB를 배우면서 MySQL이나 mongoDB를 이용해보려했는데, SQL Injection을 공부하다보니 자연스레 SQL문에는 익숙해진 것 같다.



### 내용

연습단계에서 XSS를 이용해 효과를 보는 것은 사실상 쉽지 않았다. javascript 삽입 자체는 성공했다할지라도 뭔가를 누려보기 위해선 조건이 많이 받쳐줘야했기때문.

그래서 XSS보단 SQL Injection에 관심이 더 가기는 했지만, SQL injection의 경우 내가 볼 땐 주로 php를 이용한 페이지에서 sql문을 다룰 때 사용할 수 있는 것 같은데, 이런 legacy based 웹 말고 Django 나 Flask 등으로 짜여진 modern web에서도 SQL injection이 먹히는 지 의문이다. 아마 거의 먹히지 않는 걸로 알고있다. php에서 이용하던 SQL 문에서 문자열에 장난을 치는 방식을 요즘은 parameter로 정보를 전달하는 형식으로 고쳤다는 것 같았음. 근데 확실하지는 않음.



#### SQL Injection

```
$query="SELECT id, name FROM users WHERE id='$id' LIMIT 1";
$result=mysql_query(query);
```

이러한  php source가 있다면 내가 $id에 문자열로서 '  or 1=1; -- 이러한 방식으로 전달한다면

```
$query="SELECT id, name FROM users WHERE id='' or 1=1;--
$result=mysql_query(query);
```

과 같은 결과를 얻어 모든 user의 정보를 얻을 수 있게되는 것이다.

single quotation, 주석 등등에 대한 다양한 우회방법이 있지만 그러한 우회방법이 어떤 방식들인지만 알고 암기할 정도는 아닌 것 같다.



#### SQL Injection - union

union이란 SELECT 문 두개를 묶어주는 역할을 해주는 것인데, 이 때, 두 SELECT문이 선택하는 Column들의 개수가 같아야한다.

`select id, name from users where id='$id' `를 SQL injection을 통해

`select id, name from users where id='' and 1=0 union select id, pw from users;`

이런 식으로 만들어주면 원래의 SQL 문에서 얻으려던 정보 이외의 것을 얻을 수도 있다.



### 근황

요즘 방학하고 이래저래 일도 많고 개인사정도 있어 공부를 제대로 진행은 못하고있다. 중순부턴 다시 조금씩 가다듬어 공부하고 여행도 다니고 해야겠다.



## 20190710

### 요약

동아리에서 시스템해킹 관련하여 어셈블리어를 살짝 배웠는데, 이곳에 정리하긴 애매하여 생략한다.



## 20190714

### 요약

각종 칼리 리눅스를 이용한 built in hacking tool 중 쓸만한 게 뭐가 있을 지 조금 알아봤다.

Brute Force를 위한 Hydra 나 port 나 os 를 scan해주는 NMap등을 간단히 사용해보았다.

간단히 nmap의 사용예시를 보면

![0714_nmap](imgs/0714_nmap.png)

위의 사진처럼 해당 ip 주소의 컴퓨터의 포트정보를 알 수 있다.



## 20190715

### 요약

Django pagination에 대해 좀 더 알아보았다.

Apache 와 Tomcat, Nginx등에 대한 기초 개념을 알아봤다.

Django와 Apache, nginx 등의 차이점을 알아보고 어떤 방식으로 연동하는 지 알아보았다.



### 내용

간단히 말해 Apache 나 Nginx는 웹서버 자체를 관리해주는 소프트웨어고

Django와 같은 Web Framework는 Web Application을 만드는 framework이다.

Django 나 express 자체로도 web server를 구축할 수는 있지만 여러모로 비효율적이고 불안정하기 때문에 Apache나 Nginx를 이용한다고 한다.

Legacy의 경우 Apache를 이용하고 요즘에는 대부분 Nginx를 이용하는 추세라고한다.



나는 본래에 Apache나 Nginx 는 static한 file만을 제공하는 줄 알았는데, 내가 생각했던 바와는 다르게, 로드밸런싱을 하기도 하고 caching과 관련된 기능을 한단다. 원래는 js, css, jpeg 이런 file 제공용으로만 apache를 이용하는 줄 알았는데, 웹서버를 돌리는 nginx 에 django application을 올리는 식인 것 같다.

또한 django 나 express로 웹서버를 돌리면 프로그램이 트래픽 증가로 인해 튕겨버릴 경우 그래도 종료되지만, nginx 등은 그러한 것에 대비해 kubernetes에서 replica수를 유지하듯, 서버의 상태를 유지하도록 도와주는 것 같다.



### 다음에 할 것

오늘은 개념적인 면에서만 알아보았기 때문에 정확히는 모르는데, 추후에는 nginx에 Django blog app을 올려보아야겠다.



## 20190716

### AWS EC2 Instance에 Nginx 설치하고 Nginx Beginners Guide 따라해봄.

### reverse proxy vs load balancer

load balancing은 그냥 말 그대로 적절히 접속하는 IP를 분산시켜 과부하를 막아줌. 다양한 protocol에서 사용

reverse proxy는 load balancing 기능을 하기도 하고 caching이나 보안적 이득도 있음.

reverse proxy 에서 proxy는 겉에만 나와있고, backend와 client가 직접 소통하지않으므로 보안적 이득이 있고 server의 content를 caching하여 저장함으로써 효율이 있음. 

예를 들어 `nginx`에서 `nginx -s reload`를 이용해 cacing된 content를 reload 할 수 있는 듯.

( 근데 왜 reverse proxy는 web 관련 protocol에서만 사용 가능하는 지는 모르곘네. )

[stack exchange 참고](https://serverfault.com/questions/127021/what-is-the-difference-between-load-balancer-and-reverse-proxy)



### nginx vs kubernetes

nginx 도 load balancing을 해주고 kubernetes도 load balancing을 해주는데, 왜 굳이 Pod에 Nginx를 넣는 것임?

자세히는 모르겠당.

static file  제공은 python이나 node.js로도 가능하다.

load balancing도 k8s로 가능하다.

server 유지도 k8s의 replica유지로 가능하다.

nginx의 log나 속도 및 리소스 조절 때문인가?



## 20190718

### 요약

python venv 를 이용해봄

nginx 웹서버와 Django Web Applicatio을 연동하기에 앞서 uWSGI를 이용해 웹서버를 구축해봄



### 내용

#### how to use python venv

[install python venv](https://medium.com/도서-파이썬-웹프로그래밍-실전편-요약/chapter-6-가상-환경-사용하기-새롭게-정리-30d5940de012)  에 잘 나와있지만 install 되지않는다면 `apt install python3-dev`를 입력해보자

이 때 주의할 점은 자신의 패키지 매니저 (apt)가 지원하는 python version과 자신이 사용중인 python의 version이 동일한 지 알아야한다.

![0718_venv](imgs/0718_venv.png)

사진에서처럼 나는 python 이라는 명령어로 python3.7x를 이용중인데 apt 를 통해 install 되는 python3-dev와 python-venv 등은 3.6x를 지원하는 것 같다.

따라서 동일하게 3.6x버전의 python을 이용했을 때 성공적으로 virtual environment가 생성되는 것을 알 수 있다.

생성된 디렉토리로 들어가서 `source bin/activate` 를 통해 virtual env를 이용할 수 있고, terminal에 표시가 난다.

venv를 종료하려면 `deactivate`를 입력하면 된다.



#### uWSGI를 이용해 Django app 작동시키기.

우선 서버를 운영하면서 중요한 것은 나의 app을 편리하게 배포하는 것이 아닐까 싶다. orchestration으로 replica수를 조절할 때나 다양한 node에서 나의 app을 run 시킬 때마다 배포할 때 수정해야 하는 사항이 많다면 불편할 것이다.

그래서 우선 내 app을 배포한다는 가정하에 venv를 이용해 조금은 독립적인 작업환경을 구축해보았고,

이젠 Nginx를 이용하기에 앞서 uWSGI를 이용해  내 앱을 서버를 통해 노출시켜보겠다.

우선은 **.ini** 파일을 이용해 uWSGI의 설정 즉 내 서버의 설정을 저장할 수 있다.

다양한 블로그를 참고했는데, nginx를 배울 때 조금 어려웠던 점은 글마다 설정이 달라서 뭐가 뭔지 좀 헷갈렸다는 거.. 이상하게 유튜브에도 단순 static file 제공 영상 외에는 많은 영상이 없더라

https://twpower.github.io/43-run-uwsgi-by-using-ini-file

https://uwsgi-docs.readthedocs.io/en/latest/StaticFiles.html#mode-3-using-static-file-mount-points

https://yiunsr.tistory.com/749

https://www.devdungeon.com/content/how-deploy-django-nginx-and-uwsgi

https://crystalcube.co.kr/205



아주 간단하게 .ini 설정없이 uwsgi를 이용해보고싶다면

`uwsgi --http :8080 --module={project name}.wsgi` 등을 이용해 한 줄 만으로도 자신의 django app을 `http://127.0.0.1:8080/` 등에 노출시켜볼 수 있다. (project name 수정하고, static file, node 수 등등 대부분의 설정 디폴트임 그냥)

**Django app이 어떠한 작업을 하도록 ( 스레드를 수행할 수 있도록 )해야만 Application이 원활히 돌아갈 수도 있다.** 내 application의 경우 `.ini` 파일에서 enable_threads=true 로 해줘야했음.



#### 자신의 Django app을 uWSGI나 nginx 등과 연동하려할 때 static file을 편리하게 이용하는 방법

우선 절차는 이러하다. Django Project의 기본 static 디렉토리, app 별 static 디렉토리에 있는 모든 파일과 디렉토리를 한 디렉토리에 저장한다. -> 그 디렉토리를 uWSGI나 nginx에서 static 디렉토리로 등록한다.

Django project의 `settings.py`에서 `STATIC_ROOT='/django_static'` 이런식으로 static 파일과 디렉토리를 모두 모아 저장할 위치를 정의해주고

`python manage.py collectstatic`을 통해 static 파일들을 실제로 저장한다.

이후 `ini`파일에서 `static-map = /django_static` 등으로 static file들의 경로를 지정한다.

쉽게말해 원래 django project에서 이용하던 static 디렉토리 작업은 uWSGI를 이용할 땐 수행되지 않고 uWSGI의 static 디렉토리를 이용하는 셈이다.



### 오늘의 피드백

생각보다 꽤 공부가 잘 되었고, uWSGI 튜토리얼 정도까지는 마무리할 수 있었는데 아직 uWSGI자체가 뭔지, Nginx랑은 무슨 관련인지는 자세히 모르고 설정 또한 자세히는 모르니 이 부분을 좀 더 공부해봐야겠는데, Nginx와 WSGI 부분은 왜이렇게 잘 정리된 글들이 없고 다 중구난방이냐.. 공부하기 쉽지 않다 책을 빌릴까 생각 중

아래 영상은 꽤 유익한 것 같아서 내일 볼 예정!

https://www.youtube.com/watch?v=dVEjSmKFUVI